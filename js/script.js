jQuery.expr[":"].contains=function(t,e,i){return 0<=jQuery(t).text().toUpperCase().indexOf(i[3].toUpperCase())},jQuery.expr[":"].containsSensitive=function(t,e,i){return 0<=jQuery(t).text().indexOf(i[3])},jQuery.expr[":"].contains_tag=function(t,e,i){var n=jQuery(t).data("tag").split(",");return-1!==$.inArray(i[3],n)},jQuery.expr[":"].contains_author=function(t,e,i){var n=jQuery(t).data("author").split(",");return-1!==$.inArray(i[3],n)};var blog_path=$(".theme_blog_path").val();blog_path=blog_path.lastIndexOf("/")===blog_path.length-1?blog_path.slice(0,blog_path.length-1):blog_path;var content=$(".pjax"),container=$("#post"),$searchInput=$("#local-search-input"),$tagSearchInput=$("#tag-search"),$outlineList=$("#outline-list"),$fullBtn=$(".full-toc .full"),$titleList=$("nav"),$localSearchResult=$("#local-search-result"),isFullScreen=$(window).width()<=1024,isFriend=!1,shortcutKey="false"!==$("#theme_shortcut").val();function afterPjax(){(""===blog_path?"/"===location.pathname:blog_path===location.pathname.split("/")[1])?container.addClass("index"):container.removeClass("index"),0<$("script[type='text/x-mathjax-config']").length&&$.getScript($("#MathJax-js").val(),function(){MathJax.Hub.Queue(["resetEquationNumbers",MathJax.InputJax.TeX],["Typeset",MathJax.Hub])}),content.css({opacity:1}).removeClass("fadeOuts").addClass("fadeIns"),bind(),"true"===$(".theme_disqus_on").val()&&DISQUSWIDGETS.getCount({reset:!0}),$("#comments").hasClass("disqus")&&setTimeout(function(){""===$(".count-comment").text().trim()&&$(".count-comment").text(0)},300)}$(document).pjax(".nav-right nav a,.nav-left .avatar_target,.site_url",".pjax",{fragment:".pjax",timeout:8e3}),$(document).on({"pjax:click":function(){content.removeClass("fadeIns").addClass("fadeOuts"),NProgress.start()},"pjax:start":function(){content.css({opacity:0})},"pjax:end":function(){NProgress.done(),container.scrollTop(0),afterPjax(),$(window).width()<=1024&&$fullBtn.trigger("click")},click:function(t){$(".nav-right .tags-list").hide()}}),$(".nav-left ul li>div").on("click",function(t){$(".friend").removeClass("friend"),$(".nav-left li>div.active").removeClass("active"),$(this).addClass("active"),$searchInput.val("").change();var e=$(this).data("rel").split("<---\x3e");$("#default-panel > .right-title").text(e[e.length-1]),$("#default-panel").show().siblings().hide(),$outlineList.hide()}),$(".nav-left ul.sub").each(function(){$(this).height(26*$(this).children().length-1)}),$(".nav-left ul>li>div>.fold").on("click",function(t){var e=this;t.stopPropagation(),$(e).toggleClass("unfold"),$(e).parent().next().toggleClass("hide"),$(e).parents("ul.sub").each(function(){$(e).hasClass("unfold")?$(this).height($(this).height()+parseInt($(e).parent().next().attr("style").match(/\d+/g)[0])+1):$(this).height($(this).height()-parseInt($(e).parent().next().attr("style").match(/\d+/g)[0])-1)})}),$(".nav-right nav a").mouseenter(function(t){$(".nav-right nav a.hover").removeClass("hover"),$(this).addClass("hover")}),$(".nav-right nav a").mouseleave(function(t){$(this).removeClass("hover")});var publickey={shift:!1,ctrl:!1,alt:!1,last:0};function inputChange(){setTimeout(function(){$searchInput.focus()},50);var t=$searchInput.val().trim();$("#search-panel").show().siblings().hide(),$outlineList.hide(),0<$("#local-search-result").length?3<t.length&&("in:"===t.substr(0,3).toLowerCase()||"in："===t.substr(0,3).toLowerCase())?($outlineList.hide(),$("#title-list-nav").hide(),$("#local-search-result").show(),searchAll(t.substr(3))):($("#title-list-nav").show(),$("#local-search-result").hide()):($outlineList.hide(),$("#title-list-nav").show());for(var e=$(".nav-left ul li>div.active").data("rel").split("<---\x3e"),i=0;i<e.length;i++)e[i]=e[i].replace(/(?=\/|\\|#|\(|\)|\[|\]|\.)/g,"\\");var n=e.join("."),l="",s="";$("#no-item-tips").hide(),""===t?($(".nav-right nav a").css("display","none"),$(".nav-right nav a."+n).css("display","block")):"#"===t.substr(0,1)?(l="标签",s="为",0!==t.substr(1).length&&($(".nav-right nav a").css("display","none"),$(".nav-right nav").find("a."+n+":contains_tag('"+t.substr(1)+"')").css("display","block"))):"@"===t.substr(0,1)?(l="作者",s="为",0!==t.substr(1).length&&($(".nav-right nav a").css("display","none"),$(".nav-right nav").find("a."+n+":contains_author('"+t.substr(1)+"')").css("display","block"))):(l="标题",s="包含",$(".nav-right nav a").css("display","none"),$(".nav-right nav").find("a."+n+":"+($("#search-panel > .icon-case-sensitive").hasClass("active")?"containsSensitive":"contains")+"('"+t+"')").css("display","block")),""!==t?($("#default-panel .icon-search").addClass("active"),"in:"===t?$("#no-item-tips").show().html("正在进行全局关键字搜索，请输入关键字"):t.startsWith("in:")||0!==$(".nav-right nav a:visible").length||$("#no-item-tips").show().html("未在 <span>"+n+"</span> 分类中找到"+l+s+" <span>"+t.replace(/^[@|#]/g,"")+"</span> 的文章")):$("#default-panel .icon-search").removeClass("active")}shortcutKey&&($(document).keydown(function(t){var e=container.prop("scrollHeight")-container.scrollTop()-container.height(),i=container.scrollTop();$searchInput.is(":focus")||$tagSearchInput.is(":focus")||$("#comments textarea").is(":focus")||(74===t.keyCode?container.animate({scrollTop:container.prop("scrollHeight")-container.height()},e,"linear"):75===t.keyCode?container.animate({scrollTop:0},i,"linear"):71===t.keyCode?publickey.shift?container.animate({scrollTop:container.prop("scrollHeight")},800):71===publickey.last&&container.animate({scrollTop:0},800):16===t.keyCode&&(publickey.shift=!0))}),$(document).keyup(function(t){$searchInput.is(":focus")||$tagSearchInput.is(":focus")||$("#comments textarea").is(":focus")||(83===t.which?$fullBtn.trigger("click"):73!==t.which&&105!==t.which||"0px"!==$(".nav").css("margin-left")||$(".title-list").hasClass("friend")?87===t.which?($outlineList.is(":visible")?$("#outline-panel > .icon-list").trigger("click"):($("#local-search-result").is(":visible")&&($searchInput.val(""),inputChange()),$("#default-panel").hide(),$("#title-list-nav").hide(),$("#search-panel").hide(),$("#outline-panel").show(),$outlineList.show(),syncOutline(container[0])),isFullScreen&&$fullBtn.trigger("click"),isFriend&&$(".friends-area .icon-left").trigger("click")):74===t.which||75===t.which?container.stop(!0):16===t.which&&(publickey.shift=!1):inputChange()),publickey.last=t.keyCode})),$searchInput.blur(function(t){$(".nav-right nav a.hover").removeClass("hover")}),$searchInput.keydown(function(t){if(0<$(".nav-right nav a:not(:hidden), #local-search-result a:not(:hidden)").length)if(13===t.which){var e=$(".nav-right nav a.hover:not(:hidden), #local-search-result a.hover:not(:hidden)");0===e.length?$(".nav-right nav a:not(:hidden):first, #local-search-result a:not(:hidden):first").trigger("click"):e.trigger("click"),$(":focus").blur()}else if(38===t.which)$("nav").is(":visible")?0===$("nav a:visible.hover").length||0===$("nav a:visible.hover").prevAll(":visible").length?($titleList.scrollTop($titleList.prop("scrollHeight")),$(".nav-right nav a.hover").removeClass("hover"),$(".nav-right nav a:visible:last").addClass("hover")):$("nav a.hover").prevAll().each(function(){if($(this).is(":visible"))return $(".nav-right nav a.hover").removeClass("hover"),$(this).addClass("hover"),$(this).offset().top-$(".nav-right .right-top").height()<0&&$titleList.scrollTop($titleList.scrollTop()-$(this).height()),!1}):0===$("#local-search-result a.hover").length||0===$("#local-search-result a.hover").parent().prevAll(":visible").length?($localSearchResult.scrollTop($localSearchResult.prop("scrollHeight")),$("#local-search-result a.hover").removeClass("hover"),$("#local-search-result a:visible:last").addClass("hover")):$("#local-search-result a.hover").parent().prevAll().each(function(){if($(this).is(":visible"))return $("#local-search-result a.hover").removeClass("hover"),$(this).children().addClass("hover"),$(this).offset().top-$(".nav-right .right-top").height()<0&&$localSearchResult.scrollTop($localSearchResult.scrollTop()-$(this).height()),!1});else if((9===t.which||40===t.which)&&($("nav").is(":visible")?0===$("nav a:visible.hover").length||0===$("nav a:visible.hover").nextAll(":visible").length?($titleList.scrollTop(0),$(".nav-right nav a.hover").removeClass("hover"),$(".nav-right nav a:visible:first").addClass("hover")):$("nav a.hover").nextAll().each(function(){if($(this).is(":visible"))return $(".nav-right nav a.hover").removeClass("hover"),$(this).addClass("hover"),$titleList.height()+$(".nav-right .right-top").height()-$(this).offset().top<20&&$titleList.scrollTop($titleList.scrollTop()+$(this).height()),!1}):0===$("#local-search-result a:visible.hover").length||0===$("#local-search-result a:visible.hover").parent().nextAll(":visible").length?($localSearchResult.scrollTop(0),$("#local-search-result a.hover").removeClass("hover"),$("#local-search-result a:visible:first").addClass("hover")):$("#local-search-result a.hover").parent().nextAll().each(function(){if($(this).is(":visible"))return $("#local-search-result a.hover").removeClass("hover"),$(this).children().addClass("hover"),$localSearchResult.height()+$(".nav-right .right-top").height()-$(this).offset().top<20&&$localSearchResult.scrollTop($localSearchResult.scrollTop()+$(this).prev().height()),!1}),9===t.which))return!1;27===t.which&&(""===$searchInput.val()?$("#search-panel > .icon-left").trigger("click"):$searchInput.val("").change())}),$searchInput.on("input",function(t){inputChange()}),$searchInput.on("change",function(t){inputChange()}),$(".full-toc .full,.semicircle").click(function(t){if(isFullScreen=!isFullScreen,$(window).width()<=1024&&$(".nav").hasClass("mobile"))return $(".nav").removeClass("mobile"),void $fullBtn.children().removeClass("mobile");$fullBtn.children().hasClass("min")?($fullBtn.children().removeClass("min").addClass("max"),$(".nav, .hide-list").addClass("fullscreen"),content.delay(200).queue(function(){$fullBtn.addClass("fullscreen").dequeue()})):($fullBtn.children().removeClass("max").addClass("min"),$(".nav, .hide-list").removeClass("fullscreen"),content.delay(300).queue(function(){$fullBtn.removeClass("fullscreen").dequeue()}))}),container.hover(function(){$(".semicircle").css("margin-left","-43px")},function(){$(".semicircle").css("margin-left","0")});var clickScrollTo=!1;function syncOutline(e){if(0<$('#outline-list .toc-link[href!="#"]').length&&!clickScrollTo){var i=null;$('#outline-list .toc-link[href!="#"]').each(function(t){if(e.scrollTop-$(e).find(decodeURI($(this).attr("href")))[0].offsetTop<-20)return i=0===t?0:t-1,!1}),$('#outline-list .toc-link[href!="#"].active').removeClass("active"),null===i?$('#outline-list .toc-link[href!="#"]:last').addClass("active"):$('#outline-list .toc-link[href!="#"]:eq('+i+")").addClass("active"),-80<$('#outline-list .toc-link[href!="#"].active')[0].offsetTop-$outlineList.height()-$outlineList[0].scrollTop?$outlineList.scrollTop($('#outline-list .toc-link[href!="#"].active')[0].offsetTop+80-$outlineList.height()):$('#outline-list .toc-link[href!="#"].active')[0].offsetTop<$outlineList[0].scrollTop&&$outlineList.scrollTop($('#outline-list .toc-link[href!="#"].active')[0].offsetTop)}}function bind(){"true"===$("#theme_highlight_on").val()&&$("pre code").each(function(t,e){var i=$(this).attr("class")||"",n="false"!==$("#theme_code_copy").val();$(this).after('<div class="code-embed"><span class="code-embed-type">'+(-1===i.indexOf("hljs")?i:0===i.indexOf("hljs")?"":i.replace(/[\s]?hljs/g,""))+"</span>"+(n?'<span class="code-embed-copy" onclick="copyCode(this)">复制代码</span>':"")+"</div>"),-1===i.indexOf("hljs")&&hljs.highlightBlock(e)}),initArticle(),$(".article_number").text($("#yelog_site_posts_number").val()),$(".site_word_count").text($("#yelog_site_word_count").val()),$(".site_uv").text($("#busuanzi_value_site_uv").text()),$("#busuanzi_value_site_uv").bind("DOMNodeInserted",function(t){$(".site_uv").text($(this).text())}),$(".site_pv").text($("#busuanzi_value_site_pv").text()),$("#busuanzi_value_site_pv").bind("DOMNodeInserted",function(t){$(".site_pv").text($(this).text())}),$("#post .pjax .index").find("br").remove(),$("#post .pjax .index h1:eq(0)").addClass("article-title"),$("#post .pjax article .article-meta .tag a").on("click",function(t){$searchInput.val("#"+$(this).text().trim()).change(),$(window).width()<=1024?$fullBtn.trigger("click"):$(".full-toc .full span").hasClass("max")&&$fullBtn.trigger("click")}),$("#post .pjax article .article-meta .book a").on("click",function(t){$(".nav-left ul li>div[data-rel='"+$(this).data("rel")+"']").parents(".hide").each(function(){var t=this;$(t).removeClass("hide").prev().children(".fold").addClass("unfold"),$(t).parents("ul.sub").each(function(){$(this).height(parseInt($(this).attr("style").match(/\d+/g)[0])+parseInt($(t).attr("style").match(/\d+/g)[0])+1)})}),$(".nav-left ul li>div[data-rel='"+$(this).data("rel")+"']").trigger("click"),$(window).width()<=1024?$fullBtn.trigger("click"):$(".full-toc .full span").hasClass("max")&&$fullBtn.trigger("click")}),$("#post .pjax article .article-meta .author").on("click",function(t){$searchInput.val("@"+$(this).text().trim()).change(),$(window).width()<=1024?$fullBtn.trigger("click"):$(".full-toc .full span").hasClass("max")&&$fullBtn.trigger("click")}),$("#outline-list").html($("#post .pjax article .toc-ref .toc").clone()),syncOutline(container[0]),$("a[href^='#']").click(function(){var t=$(this);0<t.parents("#outline-list").length&&($('#outline-list .toc-link[href!="#"].active').removeClass("active"),t.addClass("active")),clickScrollTo=!0;var e=$(decodeURI(t.attr("href")))[0].offsetTop;return container.animate({scrollTop:container.scrollTop>e?e+20:e-20},500,"swing",function(){clickScrollTo=!1}),$(window).width(),$(window).width()<=1024?$fullBtn.trigger("click"):$(".full-toc .full span").hasClass("max")&&$fullBtn.trigger("click"),!1}),$("#comments").hasClass("disqus")&&$(".disqus-comment-count").bind("DOMNodeInserted",function(t){$(".count-comment").text($this.text().replace(/[^0-9]/gi,""))});$(document).pjax("#post .pjax article a[target!=_blank]",".pjax",{fragment:".pjax",timeout:8e3}),"photoSwipe"!==img_resize&&content.find("img:not([data-ignore])").each(function(){if(!$(this).parent().hasClass("div_img")){$(this).wrap("<div class='div_img'></div>");var t=this.alt;t&&$(this).after('<div class="img_alt"><span>'+t+"</span></div>")}426<$(window).width()&&$(this).on("click",function(t){var e=$(this);$("body").append('<img class="img_hidden" style="display:none" src="'+this.src+'" />');var i="",n="",l="",s="";s=this.width/this.height>document.body.clientWidth/document.body.clientHeight&&$(".img_hidden").width()>document.body.clientWidth?(i=document.body.clientWidth+"px",n=this.height*document.body.clientWidth/this.width+"px",l=(document.body.clientHeight-this.height*document.body.clientWidth/this.width)/2+"px","0px"):this.width/this.height<document.body.clientWidth/document.body.clientHeight&&$(".img_hidden").height()>document.body.clientHeight?(i=this.width*document.body.clientHeight/this.height+"px",n=document.body.clientHeight+"px",l="0px",(document.body.clientWidth-this.width*document.body.clientHeight/this.height)/2+"px"):(n=$(".img_hidden").height()+"px",i=$(".img_hidden").width()+"px",l=(document.body.clientHeight-$(".img_hidden").height())/2+"px",(document.body.clientWidth-$(".img_hidden").width())/2+"px"),$("body").append('<div class="img_max" style="opacity: 0"></div>'),$("body").append('<img class="img_max" src="'+this.src+'" style="top:'+$(this).offset().top+"px;left:"+$(this).offset().left+"px; width:"+$(this).width()+"px;height: "+this.height+'px;">'),$(this).css("visibility","hidden"),setTimeout(function(){$("img.img_max").attr("style","").css({top:l,left:s,width:i,height:n}),$("div.img_max").css("opacity","1")},10),$(".img_max").on("click",function(t){$("img.img_max").css({width:e.width()+"px",height:e.height()+"px",top:e.offset().top+"px",left:e.offset().left+"px"}),$("div.img_max").css("opacity","0"),setTimeout(function(){e.css("visibility","visible"),$(".img_max").remove(),$(".img_hidden").remove()},500)})})})}function copyCode(t){$(t).parent().prev().text(),copy($(t).parent().prev().text())&&($(t).html("复制成功"),setTimeout(function(){$(t).html("复制代码")},1e3))}function copy(t){var e,i=!1;t?((e=document.createElement("div")).id="tempTarget",e.style.opacity="0",e.innerText=t,document.body.appendChild(e)):e=document.querySelector("#"+id);try{var n=document.createRange();n.selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(n),document.execCommand("copy"),window.getSelection().removeAllRanges(),i=!0}catch(t){console.log("复制失败")}return t&&e.parentElement.removeChild(e),i}$(function(){function t(){var t=$tagSearchInput.val().trim();""===t?$(".tags-list li").show():($(".tags-list li").hide(),$('.tags-list li:contains("'+t+'")').show())}bind(),$("[data-title]").quberTip({speed:200}),container.on("scroll",function(){var t=$("#rocket");200<=container.scrollTop()&&"none"===t.css("display")?$("#rocket").removeClass("launch").css("display","block").css("opacity","0.5"):container.scrollTop()<200&&"block"===t.css("display")&&$("#rocket").removeClass("launch").css("opacity","1").css("display","none"),syncOutline(this)}),$(".more-menus").on("click",function(){$(".mobile-menus-out").addClass("show"),$(".mobile-menus").addClass("show")}),$(".mobile-menus-out,.mobile-menus a").on("click",function(){$(".mobile-menus-out").removeClass("show"),$(".mobile-menus").removeClass("show")}),$("#default-panel > .icon-search").on("click",function(t){$(this).parent().hide(),$("#search-panel").show(),$searchInput.select()}),$("#search-panel > .icon-tag").on("click",function(t){t.stopPropagation();var e=$(this).offset(),i=$(window).width()<=426;$(".nav-right .tags-list").css({left:i?"auto":e.left-95+"px",top:e.top+30+"px",right:i?"0":"auto"}).toggle(100),setTimeout(function(){$tagSearchInput.val("").change().focus()},150)}),$(".nav-right .tags-list li").on("click",function(t){$searchInput.val("#"+$(this).text().trim()).change()}),$(".nav-right .tags-list").on("click",function(t){t.stopPropagation()}),$tagSearchInput.on("change",function(){t()}).on("input",function(){t()}),$("#search-panel > .icon-left").on("click",function(){$("#local-search-result").is(":visible")&&($searchInput.val(""),inputChange()),$(this).parent().hide(),$("#default-panel").show()}),$("#search-panel > .icon-case-sensitive").on("click",function(){$(this).toggleClass("active"),inputChange()}),$("#default-panel > .icon-file-tree").on("click",function(t){$(this).parent().hide(),$("#title-list-nav").hide(),$("#local-search-result").hide(),$("#outline-panel").show(),$outlineList.show(),syncOutline(container[0])}),$("#outline-panel > .icon-list").on("click",function(t){$(this).parent().hide(),$outlineList.hide(),$("#default-panel").show(),$("#title-list-nav").show()}),$(".nav-left>ul").css("height","calc(100vh - "+($(".avatar_target img").outerHeight(!0)+$(".author").outerHeight(!0)+$(".nav-left .icon").outerHeight(!0)+$(".left-bottom").outerHeight(!0))+"px)"),0<$("#local-search-result").length&&$.getScript(blog_path+"/js/search.js",function(){searchFunc(blog_path+"/search.xml","local-search-input","local-search-result")}),$("#rocket").on("click",function(t){$(this).addClass("launch"),container.animate({scrollTop:0},500)}),$("#comments").hasClass("disqus")&&setTimeout(function(){""===$(".count-comment").text().trim()&&$(".count-comment").text(0)},1500),414<$(window).width()&&$(".nav-right>nav>a>.post-title").css("width",$(".nav-right>nav>a").width()-$(".nav-right>nav>a>.post-date:first").width()-40),$(".friends").on("click",function(){isFriend=!isFriend,$(".friends-area,.title-list").toggleClass("friend")}),$(".friends-area .icon-left").on("click",function(){isFriend=!1,$(".friends-area,.title-list").removeClass("friend")})});